{
  "meta": {
    "title": "4K-3D Architecture Blueprint",
    "quality": "4K-3D",
    "version": "1.3"
  },
  "overview": "Componentized, CDN-first architecture supporting progressive 3D loading and SEO content.",
  "deployment_topology": {
    "edge_cdn": "Cloudflare / Vercel Edge",
    "static_assets": "S3 or Vercel static + Cloudflare",
    "serverless_functions": [
      "auth",
      "payment",
      "image-transforms"
    ],
    "db": "Supabase (Postgres) with row-level security for multi-tenant"
  },
  "frontend_architecture": {
    "entry": "src/main.jsx (Vite)",
    "layout": {
      "App": [
        "Routes",
        "LayoutShell",
        "SEOContent",
        "Canvas3DLoader"
      ],
      "Pages": [
        "Home",
        "Product",
        "Docs",
        "Contact"
      ]
    },
    "3d_integration_pattern": {
      "approach": "React Three Fiber (R3F) inside isolated Canvas components",
      "progressive_load": [
        "1. Inline critical HTML and hero poster for SEO",
        "2. Defer R3F Canvas on mobile and show interactive placeholder",
        "3. Use requestIdleCallback to fetch low-priority GLB assets",
        "4. Replace LODs progressively using an IntersectionObserver"
      ]
    },
    "state_management": {
      "ui": "zustand (local)",
      "app": "react-query for server state"
    },
    "routing": {
      "client": "react-router or react-router-dom",
      "prefetch": "link prefetch using rel=prefetch on hover"
    }
  },
  "api_spec": {
    "base_url": "/api",
    "endpoints": [
      {
        "method": "GET",
        "path": "/api/meta/hero",
        "desc": "returns hero asset list and signed URLs"
      },
      {
        "method": "POST",
        "path": "/api/upload",
        "desc": "handles secure uploads to Supabase storage via signed policy"
      },
      {
        "method": "GET",
        "path": "/api/config",
        "desc": "app config with feature flags"
      }
    ],
    "auth": {
      "method": "Supabase JWT",
      "scopes": [
        "user",
        "admin"
      ]
    }
  },
  "database_schema": {
    "tables": {
      "users": {
        "id": "uuid pk",
        "email": "text unique",
        "role": "enum('user','admin')",
        "created_at": "timestamp"
      },
      "projects": {
        "id": "uuid pk",
        "owner_id": "uuid fk users.id",
        "title": "text",
        "public": "boolean",
        "created_at": "timestamp"
      },
      "assets": {
        "id": "uuid pk",
        "project_id": "uuid fk projects.id",
        "type": "enum('glb','img','video')",
        "path": "text",
        "meta": "jsonb"
      }
    }
  },
  "performance_budget": {
    "total_page_bytes": 2500000,
    "critical_js_kb": 150,
    "initial_glb_bytes": 500000,
    "max_requests": 50
  },
  "ci_cd": {
    "pipeline": [
      "push → run tests (unit + lint) → build → preview deploy (Vercel) → post-build Lighthouse audit",
      "on main: production deploy + notify Slack"
    ],
    "commands": {
      "test": "npm run test",
      "build": "npm run build",
      "lint": "npm run lint"
    }
  },
  "security": {
    "headers": [
      "Content-Security-Policy",
      "X-Frame-Options"
    ],
    "rate_limit": "edge rate limiter"
  }
}